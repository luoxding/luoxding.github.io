<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Spring Data JPA ä»‹ç» | Laoluo's Blog</title>
<meta name=keywords content="Kotlin,JPA,PostgreSQL"><meta name=description content="æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Kotlin å¦‚ä½•ä½¿ç”¨ Spring Data JPA æ¥æ“ä½œ PostgreSQL æ•°æ®åº“ã€‚"><meta name=author content="James"><link rel=canonical href=http://localhost:1313/spring-data-jpa-relationship/><link crossorigin=anonymous href=/assets/css/stylesheet.d2540e28ae03a9ed42429ed74228412a18d4ea29c639e31e4f0b1512e252624f.css integrity="sha256-0lQOKK4Dqe1CQp7XQihBKhjU6inGOeMeTwsVEuJSYk8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=http://localhost:1313/icons/linux.png><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/spring-data-jpa-relationship/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/cascadia-code@4.2.1/index.min.css><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta property="og:title" content="Spring Data JPA ä»‹ç»"><meta property="og:description" content="æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Kotlin å¦‚ä½•ä½¿ç”¨ Spring Data JPA æ¥æ“ä½œ PostgreSQL æ•°æ®åº“ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/spring-data-jpa-relationship/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-27T12:16:37+08:00"><meta property="article:modified_time" content="2022-11-27T12:16:37+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spring Data JPA ä»‹ç»"><meta name=twitter:description content="æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Kotlin å¦‚ä½•ä½¿ç”¨ Spring Data JPA æ¥æ“ä½œ PostgreSQL æ•°æ®åº“ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Spring Data JPA ä»‹ç»","item":"http://localhost:1313/spring-data-jpa-relationship/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Spring Data JPA ä»‹ç»","name":"Spring Data JPA ä»‹ç»","description":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Kotlin å¦‚ä½•ä½¿ç”¨ Spring Data JPA æ¥æ“ä½œ PostgreSQL æ•°æ®åº“ã€‚\n","keywords":["Kotlin","JPA","PostgreSQL"],"articleBody":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Kotlin å¦‚ä½•ä½¿ç”¨ Spring Data JPA æ¥æ“ä½œ PostgreSQL æ•°æ®åº“ã€‚\nSpring Data JPA ä»‹ç» Spring Data JPA æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java (Kotlin) ORM åº“ï¼Œä¹Ÿæ˜¯ Spring å¤§å®¶åº­çš„ä¸€å‘˜ã€‚JPA åŠ›å›¾é€šè¿‡é¢å‘å¯¹è±¡ï¼ˆObject Orientedï¼‰çš„æ€æƒ³æ¥æ“ä½œæ•°æ®åº“ï¼Œä»¥å‡å°‘å®ç°æ•°æ®è®¿é—®å±‚ï¼ˆDAOï¼‰çš„å·¥ä½œé‡ã€‚æˆ‘ä»¬åªéœ€å®šä¹‰å­˜å‚¨åº“æ¥å£ï¼ŒSpring å°±ä¼šè‡ªåŠ¨æä¾›å®ç°ã€‚\nJPA åŸºæœ¬ä½¿ç”¨ åœ¨ä½¿ç”¨ JPA ä¹‹å‰ï¼Œé¦–å…ˆè¦è¿›è¡Œç›¸å…³ä¿¡æ¯çš„é…ç½®ã€‚ä¿®æ”¹ application.properties æ–‡ä»¶\n# postgres spring.datasource.url=jdbc:postgresql://localhost:5432/bookstore spring.datasource.username=postgres spring.datasource.password=1234 spring.datasource.driver-class-name=org.postgresql.Driver # jpa spring.jpa.hibernate.ddl-auto=update spring.jpa.show-sql=true spring.jpa.properties.hibernate.format_sql=true spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect postgres éƒ¨åˆ†å®šä¹‰äº†æ•°æ®åº“çš„åœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œä»¥åŠæ•°æ®åº“çš„é©±åŠ¨ã€‚è€Œ JPA éƒ¨åˆ†åˆ™å®šä¹‰äº† JPA è¿è¡Œæ—¶çš„ä¸€äº›è¡Œä¸ºï¼Œæ¯”å¦‚åœ¨å¯åŠ¨æ—¶å¦‚ä½•æ›´æ–°è¡¨ç»“æ„ç­‰ã€‚\næˆ‘ä»¬é¦–å…ˆå®šä¹‰å®ä½“ç±»ã€‚åˆ›å»ºæ–‡ä»¶ User.kt\n@Entity @Table(name = \"\\\"user\\\"\") class User { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @Column(name = \"username\", nullable = false) var username: String @Column(name = \"password\", nullable = false) var password: String } @Entity æ³¨è§£è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼Œè€Œ @Table æ ‡æ³¨è¡¨åã€‚æ³¨æ„è¡¨å user çš„å‰ååŠ äº†è½¬ä¹‰åçš„åŒå¼•å·ï¼Œæ˜¯å› ä¸º user æ˜¯ PostgreSQL é‡Œçš„ä¿ç•™å­—ï¼Œè¿™æ ·æ‰èƒ½æˆåŠŸå»ºè¡¨ã€‚\nè¡¨çš„å­—æ®µé¦–å…ˆæ˜¯ä¸»é”® idï¼Œç”¨ @Id æ³¨è§£è¡¨æ˜ã€‚@GeneratedValue è¡¨æ˜äº†ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ï¼Œè¿™é‡Œé€‰æ‹© IDENTITYï¼Œå³ç”±æ•°æ®åº“ç”Ÿæˆè‡ªå¢ä¸»é”®ã€‚@Colume æ³¨è§£è¡¨æ˜å­—æ®µåä»¥åŠè¯¥å­—æ®µæ˜¯å¦å¯ä¸º nullã€‚åé¢çš„ä¸¤ä¸ªå­—æ®µ username å’Œ password ä¹Ÿç±»ä¼¼ï¼Œè¿™æ ·å°±å®šä¹‰äº†ä¸€ä¸ªæœ‰ä¸‰ä¸ªå­—æ®µçš„è¡¨ã€‚\nid username password 1 abc 123456 æ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰æ•°æ®è®¿é—®æ¥å£ã€‚åˆ›å»ºæ–‡ä»¶ UserRepository.kt\ninterface UserRepository : JpaRepository { // æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ fun findByUsername(username: String): User? // æ ¹æ®ç”¨æˆ·åè®¡æ•° fun countByUsername(username: String): Long } è¿™æ ·å°±å®šä¹‰å¥½äº†ä¸¤ä¸ªæŸ¥è¯¢æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯æ ¹æ®ç”¨æˆ·åæ¥æŸ¥è¯¢ç”¨æˆ·å’Œæ ¹æ®ç”¨æˆ·åæ¥è®¡æ•°ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJPA è¿˜é»˜è®¤ç”Ÿæˆäº† findById() æ–¹æ³•ï¼Œåªä¸è¿‡å®ƒè¿”å›çš„ç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„ User ç±»ï¼Œè€Œæ˜¯ä¸€ä¸ª Optional å¯¹è±¡ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œæ‰èƒ½å–å‡ºå¯¹è±¡ã€‚\nä¸Šé¢ä»‹ç»äº†â€œå¢åˆ æ”¹æŸ¥â€ä¸­çš„æŸ¥ï¼ŒJPA çš„ â€œå¢ã€æ”¹â€æ“ä½œéƒ½æ˜¯ç”± save() æ–¹æ³•å®ç°ï¼Œâ€œåˆ â€æ˜¯ç”± delete() æ–¹æ³•å®ç°ã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ JPA æ¥æ“ä½œæ•°æ®åº“ã€‚\n// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ val user1 = userRepository.findByUsername(\"abc\") // ä¿®æ”¹å¯†ç  user1.password = \"654321\" userRepository.save(user1) // æ ¹æ®ä¸»é”®æŸ¥è¯¢ val user2 = userRepository.findById(\"def\").orElse(null) // åˆ é™¤ç”¨æˆ· userRepository.delete(user2) // æ ¹æ®ç”¨æˆ·åè®¡æ•° val count = userRepository.countByUsername(\"ghi\") JPA å…³ç³»æ˜ å°„ ä¸Šé¢ä»‹ç»äº† JPA çš„åŸºæœ¬ç”¨æ³•ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•ç”¨ JPA å®ç°æ•°æ®è¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå³ä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šå…³ç³»ã€‚\n@OneToOne ä¸€å¯¹ä¸€æ˜¯æœ€ç®€å•çš„æ˜ å°„å…³ç³»ã€‚ä¾‹å¦‚ä¸€ä¸ªäººåªæœ‰ä¸€å¼ èº«ä»½è¯ï¼Œè€Œä¸€å¼ èº«ä»½è¯å¯¹åº”ä¸€ä¸ªäººã€‚ä¸€å¯¹ä¸€å…³ç³»å¯ä»¥ç”±ä»»ä½•ä¸€æ–¹æ¥ç»´æŠ¤ã€‚\n// å…¬æ°‘è¡¨ @Entity @Table(name = \"Person\") class Person { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @OneToOne var idCard: IdCard? = null } // èº«ä»½è¯è¡¨ @Entity @Table(name = \"IdCard\") class IdCard { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @OneToOne(mappedBy = \"idCard\") var person? = null } mappedBy è¡¨æ˜è¿™ä¸ªä¸€å¯¹ä¸€å…³ç³»ç”± Person è¡¨ç»´æŠ¤ã€‚\n@OneToMany ä¸€å¯¹å¤šå…³ç³»ä¹Ÿå¾ˆå¸¸è§ï¼Œä¾‹å¦‚ä¹¦ç±å’Œå‡ºç‰ˆç¤¾çš„å…³ç³»ã€‚æ¯æœ¬ä¹¦ç±åªæœ‰ä¸€ä¸ªå‡ºç‰ˆç¤¾ï¼Œè€Œä¸€ä¸ªå‡ºç‰ˆç¤¾å¯¹åº”å¾ˆå¤šæœ¬ä¹¦ç±ã€‚ä¸€å¯¹å¤šå…³ç³»é€šå¸¸ç”±å¤šçš„é‚£ä¸€æ–¹æ¥ç»´æŠ¤ã€‚\n// ä¹¦ç±è¡¨ @Entity @Table(name = \"Book\") class Book { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @ManyToOne var press: Press? = null } // å‡ºç‰ˆç¤¾è¡¨ @Entity @Table(name = \"Press\") class Press { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @OneToMany(mappedBy = \"press\") var books: MutableSet = mutableSetOf() } è¿™æ · Press çš„ä¸»é”®ä¼šä½œä¸ºä¸€ä¸ªå­—æ®µæ’å…¥åˆ° Book è¡¨ä¸­ã€‚Book è¡¨å°±åƒè¿™æ ·\nid press_id 1 2 è€Œå¦‚æœæˆ‘ä»¬æŒ‡å®šè®©ä¸€çš„ä¸€æ–¹ç»´æŠ¤å…³ç³»çš„è¯ï¼Œå°±éœ€è¦ä¸€ä¸ªä¸­é—´è¡¨æ¥å­˜å‚¨å…³ç³»ï¼Œå¢å¤§äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚\n@ManyToMany ä¹¦ç±å’Œä½œè€…çš„å…³ç³»æ˜¯ä¸€ç§å…¸å‹çš„å¤šå¯¹å¤šå…³ç³»ã€‚æ¯æœ¬ä¹¦ç±å¯ä»¥æœ‰å¤šä¸ªä½œè€…ï¼Œè€Œæ¯ä¸ªä½œè€…ä¹Ÿå¯ä»¥å¯¹åº”å¤šæœ¬ä¹¦ç±ã€‚å¤šå¯¹å¤šå…³ç³»å¯ä»¥ç”±åŒæ–¹çš„ä»»ä¸€æ–¹æ¥ç»´æŠ¤ã€‚å¤šå¯¹å¤šå…³ç³»éœ€è¦ä¸€ä¸ªä¸­é—´è¡¨æ¥å­˜å‚¨ã€‚\n// ä¹¦ç±è¡¨ @Entity @Table(name = \"book\") class Book { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @ManyToMany(fetch = FetchType.EAGER) @JoinTabler name = \"book_author\", joinColumns = [JoinColumn(name = \"book_id\")], inverseJoinColumns = [JoinColumn(name = \"author_id\")] ) var authors: MutableSet = mutableSetOf(), } // ä½œè€…è¡¨ @Entity @Table(name = \"author\") class Author { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @ManyToMany(mappedBy = \"authors\") var books: MutableSet = mutableSetOf(), } è¿™æ ·å°±ä¼šåˆ›å»ºä¸€ä¸ªåä¸º â€œbook_authorâ€ çš„ä¸­é—´è¡¨æ¥å­˜å‚¨ Book å’Œ Author çš„å…³ç³»ï¼Œè¡¨çš„å†…å®¹ä¸º Book å’Œ Author çš„ä¸»é”®ã€‚\nbook_id author_id 3 5 @ElementCollection ä¸‹é¢ä»¥â€œå•†å“-è®¢å•â€å…³ç³»æ¥ä»‹ç»ä¸€ç§ç›¸å¯¹å¤æ‚çš„æ˜ å°„å…³ç³»ã€‚åœ¨è®¢å•ä¸­æœ‰å¤šç§å•†å“ï¼Œè€Œæ¯ä¸ªå•†å“åˆæœ‰ç€ä¸åŒçš„æ•°é‡ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡ @ElementCollecion å’Œ MapKeyJoinColumn æ¥å®ç°ã€‚\n// å•†å“è¡¨ @Entity @Table(name = \"product\") class Product { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null } //è®¢å•è¡¨ @Entity @Table(name = \"\\\"order\\\"\") class Order { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @ElementCollection @CollectionTable( name = \"order_product\", joinColumns = [JoinColumn(name = \"product_id\")] ) @Column(name = \"product_amount\") @MapKeyJoinColumn(name = \"order_id\") var products: MutableMap = mutableMapOf() } è¿™æ ·ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªåä¸º â€œorder_productâ€ çš„ä¸­é—´è¡¨æ¥å­˜å‚¨è®¢å•ä¸­å„ç±»å•†å“çš„æ•°é‡å…³ç³»ï¼Œè¡¨çš„å†…å®¹ä¸º\norder_id product_id product_amount 1001 2050 3 1001 2077 2 æ·»åŠ ç´¢å¼• æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @Table æ³¨è§£æ¥æ·»åŠ ç´¢å¼•ã€‚å¦‚\n@Entity @Table( name = \"book\", indexes = [ Index(name = \"idx_name\", columnList = \"name\", unique = false), Index(name = \"uni_isbn\", columnList = \"isbn\", unique = true), ] ) class Book { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @Column(name = \"name\", nullable = false) var name: String, @Column(name = \"isbn\", nullable = false) var isbn: String, } ä¸Šé¢ä¸º Book è¡¨æ·»åŠ äº†ä¸¤æ¡ç´¢å¼•ï¼Œåˆ†åˆ«æ˜¯å¯¹äºä¹¦ç±åå­—çš„æ™®é€šç´¢å¼•å’Œå¯¹äº ISBN ç¼–å·çš„å”¯ä¸€ç´¢å¼•ã€‚é€šè¿‡ç´¢å¼•å¯ä»¥å¤§å¤§æé«˜æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ã€‚\nå¼€å¯å®¡è®¡ JPA çš„å®¡è®¡åŠŸèƒ½å¯ä»¥æ–¹ä¾¿åœ°è®°å½•æ•°æ®é¡¹çš„åˆ›å»ºæ—¶é—´å’Œæœ€åä¿®æ”¹æ—¶é—´ï¼Œåªéœ€è¦åœ¨å®ä½“ç±»ä¸Šæ·»åŠ  @EntityListeners æ³¨è§£ã€‚\n@Entity @Table(name = \"\\\"user\\\"\") @EntityListeners(AuditingEntityListener::class) class User { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null @CreatedDate @Column(name = \"created_time\", nullable = false) var createdTime: LocalDateTime? = null @LastModifiedDate @Column(name = \"modified_time\", nullable = false) var modifiedTime: LocalDateTime? = null } å®ä½“ç±»ç»§æ‰¿ å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰€æœ‰çš„å®ä½“ç±»éƒ½ç»§æ‰¿è‡ªä¸€ä¸ªåŸºç±»çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ MappedSuperclass æ³¨è§£ã€‚\nè¢«è¯¥æ³¨è§£æ ‡æ³¨çš„ç±»ä¸ä¼šåœ¨æ•°æ®åº“ä¸­åˆ›å»ºå•ç‹¬çš„è¡¨ï¼Œä½†è¯¥ç±»æ‰€æ‹¥æœ‰çš„å±æ€§éƒ½å°†æ˜ å°„åˆ°å…¶å­ç±»çš„æ•°æ®åº“è¡¨çš„å­—æ®µä¸­ã€‚\nä¾‹å¦‚\n// åŸºç±» @MappedSuperclass class BaseEntity { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"id\", nullable = false) var id: Long? = null } // ç”¨æˆ·è¡¨ @Entity @Table(name = \"\\\"user\\\"\") class User: BaseEntity() { @Column(name = \"username\", nullable = false) var username: String @Column(name = \"password\", nullable = false) var password: String } è¿™æ · User è¡¨å°±æœ‰ä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ idï¼Œusername ä»¥åŠ passwordã€‚\nKotlin All-open æ’ä»¶ ç”±äº Spring AOP çš„è®¾è®¡ï¼Œæ‰€æœ‰ Spring ç›¸å…³çš„ç±»éƒ½éœ€è¦æ˜¯ open çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ all-open æ’ä»¶æ¥æ–¹ä¾¿åœ°è§£å†³è¿™ä¸€é—®é¢˜ã€‚\nall-open æ’ä»¶é»˜è®¤æ”¯æŒä»¥ä¸‹æ³¨è§£ï¼š\n@Component @Async @Transactional @Cacheable @SpringBootTest ç”±äº @Component æ˜¯ @Configurationã€@Controllerã€@RestControllerã€@Service ä»¥åŠ @Repository çš„å…ƒæ³¨è§£ï¼Œæ‰€ä»¥ä»¥ä¸Šæ³¨è§£ä¹Ÿéƒ½é»˜è®¤ä¸º openã€‚\næ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ’ä»¶ä¸­æ·»åŠ  JPA ç›¸å…³æ³¨è§£å°±å¯ä»¥äº†ã€‚\nä¿®æ”¹ build.gradle.kts æ–‡ä»¶\nallOpen { annotation(\"jakarta.persistence.MappedSuperclass\") annotation(\"jakarta.persistence.Entity\") } ","wordCount":"757","inLanguage":"en","datePublished":"2022-11-27T12:16:37+08:00","dateModified":"2022-11-27T12:16:37+08:00","author":{"@type":"Person","name":"James"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/spring-data-jpa-relationship/"},"publisher":{"@type":"Organization","name":"Laoluo's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/icons/linux.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Laoluo's Blog (Alt + H)">Laoluo's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=http://localhost:1313/about/ title=å…³äº><span>å…³äº</span></a></li><li><a href=http://localhost:1313/archives title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=http://localhost:1313/categories/ title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=http://localhost:1313/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=http://localhost:1313/manual/ title=é€ŸæŸ¥><span>é€ŸæŸ¥</span></a></li><li><a href=http://localhost:1313/links/ title=é“¾æ¥><span>é“¾æ¥</span></a></li><li><a href=http://localhost:1313/search/ title=ğŸ”><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Spring Data JPA ä»‹ç»</h1><div class=post-meta><span title='2022-11-27 12:16:37 +0800 CST'>November 27, 2022</span>&nbsp;Â·&nbsp;James</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#spring-data-jpa-%e4%bb%8b%e7%bb%8d aria-label="Spring Data JPA ä»‹ç»">Spring Data JPA ä»‹ç»</a></li><li><a href=#jpa-%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8 aria-label="JPA åŸºæœ¬ä½¿ç”¨">JPA åŸºæœ¬ä½¿ç”¨</a></li><li><a href=#jpa-%e5%85%b3%e7%b3%bb%e6%98%a0%e5%b0%84 aria-label="JPA å…³ç³»æ˜ å°„">JPA å…³ç³»æ˜ å°„</a><ul><li><a href=#onetoone aria-label=@OneToOne>@OneToOne</a></li><li><a href=#onetomany aria-label=@OneToMany>@OneToMany</a></li><li><a href=#manytomany aria-label=@ManyToMany>@ManyToMany</a></li><li><a href=#elementcollection aria-label=@ElementCollection>@ElementCollection</a></li></ul></li><li><a href=#%e6%b7%bb%e5%8a%a0%e7%b4%a2%e5%bc%95 aria-label=æ·»åŠ ç´¢å¼•>æ·»åŠ ç´¢å¼•</a></li><li><a href=#%e5%bc%80%e5%90%af%e5%ae%a1%e8%ae%a1 aria-label=å¼€å¯å®¡è®¡>å¼€å¯å®¡è®¡</a></li><li><a href=#%e5%ae%9e%e4%bd%93%e7%b1%bb%e7%bb%a7%e6%89%bf aria-label=å®ä½“ç±»ç»§æ‰¿>å®ä½“ç±»ç»§æ‰¿</a></li><li><a href=#kotlin-all-open-%e6%8f%92%e4%bb%b6 aria-label="Kotlin All-open æ’ä»¶">Kotlin All-open æ’ä»¶</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Kotlin å¦‚ä½•ä½¿ç”¨ Spring Data JPA æ¥æ“ä½œ PostgreSQL æ•°æ®åº“ã€‚</p><h2 id=spring-data-jpa-ä»‹ç»>Spring Data JPA ä»‹ç»<a hidden class=anchor aria-hidden=true href=#spring-data-jpa-ä»‹ç»>#</a></h2><p>Spring Data JPA æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java (Kotlin) ORM åº“ï¼Œä¹Ÿæ˜¯ Spring å¤§å®¶åº­çš„ä¸€å‘˜ã€‚JPA åŠ›å›¾é€šè¿‡é¢å‘å¯¹è±¡ï¼ˆObject Orientedï¼‰çš„æ€æƒ³æ¥æ“ä½œæ•°æ®åº“ï¼Œä»¥å‡å°‘å®ç°æ•°æ®è®¿é—®å±‚ï¼ˆDAOï¼‰çš„å·¥ä½œé‡ã€‚æˆ‘ä»¬åªéœ€å®šä¹‰å­˜å‚¨åº“æ¥å£ï¼ŒSpring å°±ä¼šè‡ªåŠ¨æä¾›å®ç°ã€‚</p><h2 id=jpa-åŸºæœ¬ä½¿ç”¨>JPA åŸºæœ¬ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#jpa-åŸºæœ¬ä½¿ç”¨>#</a></h2><p>åœ¨ä½¿ç”¨ JPA ä¹‹å‰ï¼Œé¦–å…ˆè¦è¿›è¡Œç›¸å…³ä¿¡æ¯çš„é…ç½®ã€‚ä¿®æ”¹ <code>application.properties</code> æ–‡ä»¶</p><pre tabindex=0><code># postgres
spring.datasource.url=jdbc:postgresql://localhost:5432/bookstore
spring.datasource.username=postgres
spring.datasource.password=1234
spring.datasource.driver-class-name=org.postgresql.Driver
# jpa
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
</code></pre><p>postgres éƒ¨åˆ†å®šä¹‰äº†æ•°æ®åº“çš„åœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œä»¥åŠæ•°æ®åº“çš„é©±åŠ¨ã€‚è€Œ JPA éƒ¨åˆ†åˆ™å®šä¹‰äº† JPA è¿è¡Œæ—¶çš„ä¸€äº›è¡Œä¸ºï¼Œæ¯”å¦‚åœ¨å¯åŠ¨æ—¶å¦‚ä½•æ›´æ–°è¡¨ç»“æ„ç­‰ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰å®ä½“ç±»ã€‚åˆ›å»ºæ–‡ä»¶ <code>User.kt</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>user</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;username&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> username: String
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;password&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> password: String
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>@Entity</code> æ³¨è§£è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼Œè€Œ <code>@Table</code> æ ‡æ³¨è¡¨åã€‚æ³¨æ„è¡¨å user çš„å‰ååŠ äº†è½¬ä¹‰åçš„åŒå¼•å·ï¼Œæ˜¯å› ä¸º user æ˜¯ PostgreSQL é‡Œçš„ä¿ç•™å­—ï¼Œè¿™æ ·æ‰èƒ½æˆåŠŸå»ºè¡¨ã€‚</p><p>è¡¨çš„å­—æ®µé¦–å…ˆæ˜¯ä¸»é”® idï¼Œç”¨ <code>@Id</code> æ³¨è§£è¡¨æ˜ã€‚<code>@GeneratedValue</code> è¡¨æ˜äº†ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ï¼Œè¿™é‡Œé€‰æ‹© <code>IDENTITY</code>ï¼Œå³ç”±æ•°æ®åº“ç”Ÿæˆè‡ªå¢ä¸»é”®ã€‚<code>@Colume</code> æ³¨è§£è¡¨æ˜å­—æ®µåä»¥åŠè¯¥å­—æ®µæ˜¯å¦å¯ä¸º <code>null</code>ã€‚åé¢çš„ä¸¤ä¸ªå­—æ®µ username å’Œ password ä¹Ÿç±»ä¼¼ï¼Œè¿™æ ·å°±å®šä¹‰äº†ä¸€ä¸ªæœ‰ä¸‰ä¸ªå­—æ®µçš„è¡¨ã€‚</p><table><thead><tr><th>id</th><th>username</th><th>password</th></tr></thead><tbody><tr><td>1</td><td>abc</td><td>123456</td></tr></tbody></table><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰æ•°æ®è®¿é—®æ¥å£ã€‚åˆ›å»ºæ–‡ä»¶ <code>UserRepository.kt</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserRepository</span> : JpaRepository&lt;User, Long&gt; {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>findByUsername</span>(username: String): User?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ ¹æ®ç”¨æˆ·åè®¡æ•°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>countByUsername</span>(username: String): Long
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ ·å°±å®šä¹‰å¥½äº†ä¸¤ä¸ªæŸ¥è¯¢æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯æ ¹æ®ç”¨æˆ·åæ¥æŸ¥è¯¢ç”¨æˆ·å’Œæ ¹æ®ç”¨æˆ·åæ¥è®¡æ•°ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJPA è¿˜é»˜è®¤ç”Ÿæˆäº† findById() æ–¹æ³•ï¼Œåªä¸è¿‡å®ƒè¿”å›çš„ç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„ User ç±»ï¼Œè€Œæ˜¯ä¸€ä¸ª Optional å¯¹è±¡ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œæ‰èƒ½å–å‡ºå¯¹è±¡ã€‚</p><p>ä¸Šé¢ä»‹ç»äº†â€œå¢åˆ æ”¹æŸ¥â€ä¸­çš„æŸ¥ï¼ŒJPA çš„ â€œå¢ã€æ”¹â€æ“ä½œéƒ½æ˜¯ç”± save() æ–¹æ³•å®ç°ï¼Œâ€œåˆ â€æ˜¯ç”± delete() æ–¹æ³•å®ç°ã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ JPA æ¥æ“ä½œæ•°æ®åº“ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=display:flex><span><span style=color:#75715e>// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> user1 = userRepository.findByUsername(<span style=color:#e6db74>&#34;abc&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// ä¿®æ”¹å¯†ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>user1.password = <span style=color:#e6db74>&#34;654321&#34;</span>
</span></span><span style=display:flex><span>userRepository.save(user1)
</span></span><span style=display:flex><span><span style=color:#75715e>// æ ¹æ®ä¸»é”®æŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> user2 = userRepository.findById(<span style=color:#e6db74>&#34;def&#34;</span>).orElse(<span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// åˆ é™¤ç”¨æˆ·
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>userRepository.delete(user2)
</span></span><span style=display:flex><span><span style=color:#75715e>// æ ¹æ®ç”¨æˆ·åè®¡æ•°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> count = userRepository.countByUsername(<span style=color:#e6db74>&#34;ghi&#34;</span>)
</span></span></code></pre></div><h2 id=jpa-å…³ç³»æ˜ å°„>JPA å…³ç³»æ˜ å°„<a hidden class=anchor aria-hidden=true href=#jpa-å…³ç³»æ˜ å°„>#</a></h2><p>ä¸Šé¢ä»‹ç»äº† JPA çš„åŸºæœ¬ç”¨æ³•ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•ç”¨ JPA å®ç°æ•°æ®è¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå³ä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šå…³ç³»ã€‚</p><h3 id=onetoone>@OneToOne<a hidden class=anchor aria-hidden=true href=#onetoone>#</a></h3><p>ä¸€å¯¹ä¸€æ˜¯æœ€ç®€å•çš„æ˜ å°„å…³ç³»ã€‚ä¾‹å¦‚ä¸€ä¸ªäººåªæœ‰ä¸€å¼ èº«ä»½è¯ï¼Œè€Œä¸€å¼ èº«ä»½è¯å¯¹åº”ä¸€ä¸ªäººã€‚ä¸€å¯¹ä¸€å…³ç³»å¯ä»¥ç”±ä»»ä½•ä¸€æ–¹æ¥ç»´æŠ¤ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=display:flex><span><span style=color:#75715e>// å…¬æ°‘è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;Person&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OneToOne</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> idCard: IdCard? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// èº«ä»½è¯è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;IdCard&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IdCard</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OneToOne</span>(mappedBy = <span style=color:#e6db74>&#34;idCard&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> person? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>mappedBy è¡¨æ˜è¿™ä¸ªä¸€å¯¹ä¸€å…³ç³»ç”± Person è¡¨ç»´æŠ¤ã€‚</p><h3 id=onetomany>@OneToMany<a hidden class=anchor aria-hidden=true href=#onetomany>#</a></h3><p>ä¸€å¯¹å¤šå…³ç³»ä¹Ÿå¾ˆå¸¸è§ï¼Œä¾‹å¦‚ä¹¦ç±å’Œå‡ºç‰ˆç¤¾çš„å…³ç³»ã€‚æ¯æœ¬ä¹¦ç±åªæœ‰ä¸€ä¸ªå‡ºç‰ˆç¤¾ï¼Œè€Œä¸€ä¸ªå‡ºç‰ˆç¤¾å¯¹åº”å¾ˆå¤šæœ¬ä¹¦ç±ã€‚ä¸€å¯¹å¤šå…³ç³»é€šå¸¸ç”±å¤šçš„é‚£ä¸€æ–¹æ¥ç»´æŠ¤ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=display:flex><span><span style=color:#75715e>// ä¹¦ç±è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;Book&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Book</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ManyToOne</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> press: Press? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å‡ºç‰ˆç¤¾è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;Press&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Press</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OneToMany</span>(mappedBy = <span style=color:#e6db74>&#34;press&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> books: MutableSet&lt;Book&gt; = mutableSetOf()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ · Press çš„ä¸»é”®ä¼šä½œä¸ºä¸€ä¸ªå­—æ®µæ’å…¥åˆ° Book è¡¨ä¸­ã€‚Book è¡¨å°±åƒè¿™æ ·</p><table><thead><tr><th>id</th><th>press_id</th></tr></thead><tbody><tr><td>1</td><td>2</td></tr></tbody></table><p>è€Œå¦‚æœæˆ‘ä»¬æŒ‡å®šè®©ä¸€çš„ä¸€æ–¹ç»´æŠ¤å…³ç³»çš„è¯ï¼Œå°±éœ€è¦ä¸€ä¸ªä¸­é—´è¡¨æ¥å­˜å‚¨å…³ç³»ï¼Œå¢å¤§äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</p><h3 id=manytomany>@ManyToMany<a hidden class=anchor aria-hidden=true href=#manytomany>#</a></h3><p>ä¹¦ç±å’Œä½œè€…çš„å…³ç³»æ˜¯ä¸€ç§å…¸å‹çš„å¤šå¯¹å¤šå…³ç³»ã€‚æ¯æœ¬ä¹¦ç±å¯ä»¥æœ‰å¤šä¸ªä½œè€…ï¼Œè€Œæ¯ä¸ªä½œè€…ä¹Ÿå¯ä»¥å¯¹åº”å¤šæœ¬ä¹¦ç±ã€‚å¤šå¯¹å¤šå…³ç³»å¯ä»¥ç”±åŒæ–¹çš„ä»»ä¸€æ–¹æ¥ç»´æŠ¤ã€‚å¤šå¯¹å¤šå…³ç³»éœ€è¦ä¸€ä¸ªä¸­é—´è¡¨æ¥å­˜å‚¨ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// ä¹¦ç±è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;book&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Book</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ManyToMany</span>(fetch = <span style=color:#a6e22e>FetchType</span>.EAGER)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JoinTabler</span>
</span></span><span style=display:flex><span>        name = <span style=color:#e6db74>&#34;book_author&#34;</span>,
</span></span><span style=display:flex><span>        joinColumns = [JoinColumn(name = <span style=color:#e6db74>&#34;book_id&#34;</span>)],
</span></span><span style=display:flex><span>        inverseJoinColumns = [JoinColumn(name = <span style=color:#e6db74>&#34;author_id&#34;</span>)]
</span></span><span style=display:flex><span>    ) <span style=color:#66d9ef>var</span> authors: MutableSet&lt;Author&gt; = mutableSetOf(),
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä½œè€…è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;author&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Author</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ManyToMany</span>(mappedBy = <span style=color:#e6db74>&#34;authors&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> books: MutableSet&lt;Book&gt; = mutableSetOf(),
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ ·å°±ä¼šåˆ›å»ºä¸€ä¸ªåä¸º &ldquo;book_author&rdquo; çš„ä¸­é—´è¡¨æ¥å­˜å‚¨ Book å’Œ Author çš„å…³ç³»ï¼Œè¡¨çš„å†…å®¹ä¸º Book å’Œ Author çš„ä¸»é”®ã€‚</p><table><thead><tr><th>book_id</th><th>author_id</th></tr></thead><tbody><tr><td>3</td><td>5</td></tr></tbody></table><h3 id=elementcollection>@ElementCollection<a hidden class=anchor aria-hidden=true href=#elementcollection>#</a></h3><p>ä¸‹é¢ä»¥â€œå•†å“-è®¢å•â€å…³ç³»æ¥ä»‹ç»ä¸€ç§ç›¸å¯¹å¤æ‚çš„æ˜ å°„å…³ç³»ã€‚åœ¨è®¢å•ä¸­æœ‰å¤šç§å•†å“ï¼Œè€Œæ¯ä¸ªå•†å“åˆæœ‰ç€ä¸åŒçš„æ•°é‡ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡ <code>@ElementCollecion</code> å’Œ <code>MapKeyJoinColumn</code> æ¥å®ç°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// å•†å“è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;product&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Product</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//è®¢å•è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>order</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Order</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ElementCollection</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@CollectionTable</span>(
</span></span><span style=display:flex><span>        name = <span style=color:#e6db74>&#34;order_product&#34;</span>,
</span></span><span style=display:flex><span>        joinColumns = [JoinColumn(name = <span style=color:#e6db74>&#34;product_id&#34;</span>)]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;product_amount&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@MapKeyJoinColumn</span>(name = <span style=color:#e6db74>&#34;order_id&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> products: MutableMap&lt;product, Int&gt; = mutableMapOf()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ ·ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªåä¸º &ldquo;order_product&rdquo; çš„ä¸­é—´è¡¨æ¥å­˜å‚¨è®¢å•ä¸­å„ç±»å•†å“çš„æ•°é‡å…³ç³»ï¼Œè¡¨çš„å†…å®¹ä¸º</p><table><thead><tr><th>order_id</th><th>product_id</th><th>product_amount</th></tr></thead><tbody><tr><td>1001</td><td>2050</td><td>3</td></tr><tr><td>1001</td><td>2077</td><td>2</td></tr></tbody></table><h2 id=æ·»åŠ ç´¢å¼•>æ·»åŠ ç´¢å¼•<a hidden class=anchor aria-hidden=true href=#æ·»åŠ ç´¢å¼•>#</a></h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>@Table</code> æ³¨è§£æ¥æ·»åŠ ç´¢å¼•ã€‚å¦‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(
</span></span><span style=display:flex><span>    name = <span style=color:#e6db74>&#34;book&#34;</span>,
</span></span><span style=display:flex><span>    indexes = [
</span></span><span style=display:flex><span>        Index(name = <span style=color:#e6db74>&#34;idx_name&#34;</span>, columnList = <span style=color:#e6db74>&#34;name&#34;</span>, unique = <span style=color:#66d9ef>false</span>),
</span></span><span style=display:flex><span>        Index(name = <span style=color:#e6db74>&#34;uni_isbn&#34;</span>, columnList = <span style=color:#e6db74>&#34;isbn&#34;</span>, unique = <span style=color:#66d9ef>true</span>),
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Book</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;name&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> name: String,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;isbn&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> isbn: String,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¸Šé¢ä¸º Book è¡¨æ·»åŠ äº†ä¸¤æ¡ç´¢å¼•ï¼Œåˆ†åˆ«æ˜¯å¯¹äºä¹¦ç±åå­—çš„æ™®é€šç´¢å¼•å’Œå¯¹äº ISBN ç¼–å·çš„å”¯ä¸€ç´¢å¼•ã€‚é€šè¿‡ç´¢å¼•å¯ä»¥å¤§å¤§æé«˜æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</p><h2 id=å¼€å¯å®¡è®¡>å¼€å¯å®¡è®¡<a hidden class=anchor aria-hidden=true href=#å¼€å¯å®¡è®¡>#</a></h2><p>JPA çš„å®¡è®¡åŠŸèƒ½å¯ä»¥æ–¹ä¾¿åœ°è®°å½•æ•°æ®é¡¹çš„åˆ›å»ºæ—¶é—´å’Œæœ€åä¿®æ”¹æ—¶é—´ï¼Œåªéœ€è¦åœ¨å®ä½“ç±»ä¸Šæ·»åŠ  <code>@EntityListeners</code> æ³¨è§£ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>user</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EntityListeners</span>(AuditingEntityListener<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@CreatedDate</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;created_time&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> createdTime: LocalDateTime? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@LastModifiedDate</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;modified_time&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> modifiedTime: LocalDateTime? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=å®ä½“ç±»ç»§æ‰¿>å®ä½“ç±»ç»§æ‰¿<a hidden class=anchor aria-hidden=true href=#å®ä½“ç±»ç»§æ‰¿>#</a></h2><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰€æœ‰çš„å®ä½“ç±»éƒ½ç»§æ‰¿è‡ªä¸€ä¸ªåŸºç±»çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>MappedSuperclass</code> æ³¨è§£ã€‚</p><p>è¢«è¯¥æ³¨è§£æ ‡æ³¨çš„ç±»ä¸ä¼šåœ¨æ•°æ®åº“ä¸­åˆ›å»ºå•ç‹¬çš„è¡¨ï¼Œä½†è¯¥ç±»æ‰€æ‹¥æœ‰çš„å±æ€§éƒ½å°†æ˜ å°„åˆ°å…¶å­ç±»çš„æ•°æ®åº“è¡¨çš„å­—æ®µä¸­ã€‚</p><p>ä¾‹å¦‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=display:flex><span><span style=color:#75715e>// åŸºç±»
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@MappedSuperclass</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BaseEntity</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(strategy = <span style=color:#a6e22e>GenerationType</span>.IDENTITY)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;id&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id: Long? = <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ç”¨æˆ·è¡¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>user</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span>: BaseEntity() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;username&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> username: String
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Column</span>(name = <span style=color:#e6db74>&#34;password&#34;</span>, nullable = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> password: String
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ · User è¡¨å°±æœ‰ä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ <code>id</code>ï¼Œ<code>username</code> ä»¥åŠ <code>password</code>ã€‚</p><h2 id=kotlin-all-open-æ’ä»¶>Kotlin All-open æ’ä»¶<a hidden class=anchor aria-hidden=true href=#kotlin-all-open-æ’ä»¶>#</a></h2><p>ç”±äº Spring AOP çš„è®¾è®¡ï¼Œæ‰€æœ‰ Spring ç›¸å…³çš„ç±»éƒ½éœ€è¦æ˜¯ open çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>all-open</code> æ’ä»¶æ¥æ–¹ä¾¿åœ°è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p><p><code>all-open</code> æ’ä»¶é»˜è®¤æ”¯æŒä»¥ä¸‹æ³¨è§£ï¼š</p><ul><li><code>@Component</code></li><li><code>@Async</code></li><li><code>@Transactional</code></li><li><code>@Cacheable</code></li><li><code>@SpringBootTest</code></li></ul><p>ç”±äº <code>@Component</code> æ˜¯ <code>@Configuration</code>ã€<code>@Controller</code>ã€<code>@RestController</code>ã€<code>@Service</code> ä»¥åŠ <code>@Repository</code> çš„å…ƒæ³¨è§£ï¼Œæ‰€ä»¥ä»¥ä¸Šæ³¨è§£ä¹Ÿéƒ½é»˜è®¤ä¸º openã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ’ä»¶ä¸­æ·»åŠ  JPA ç›¸å…³æ³¨è§£å°±å¯ä»¥äº†ã€‚</p><p>ä¿®æ”¹ <code>build.gradle.kts</code> æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=display:flex><span>allOpen {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>annotation</span>(<span style=color:#e6db74>&#34;jakarta.persistence.MappedSuperclass&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>annotation</span>(<span style=color:#e6db74>&#34;jakarta.persistence.Entity&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/kotlin/>Kotlin</a></li><li><a href=http://localhost:1313/tags/jpa/>JPA</a></li><li><a href=http://localhost:1313/tags/postgresql/>PostgreSQL</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/introduction-to-jwt/><span class=title>Â« Prev</span><br><span>JWT ç™»å½•ç®€ä»‹</span>
</a><a class=next href=http://localhost:1313/install-archlinux-using-archinstall/><span class=title>Next Â»</span><br><span>ä½¿ç”¨ archinstall ä¾¿æ·å®‰è£… Arch Linux</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Laoluo's Blog</a></span>
<span>| Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><br><a href=https://beian.miit.gov.cn/ target=_blank>é»”ICPå¤‡2022001597å·</a></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>